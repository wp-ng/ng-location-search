!function(x){"use strict";x.module("ngLocationSearch",[]).directive("ngLocationSearch",["$rootScope","$log","$timeout","$location","$window","$parse","$httpParamSerializer",function(b,n,L,y,D,O,w){return{restrict:"A",require:["?ngModel","?^form"],link:function(g,n,i,e){function $(n){return!!x.isString(n)&&n.replace(/\/$/,"")}function o(n,e){switch(e){case"array":return x.isArray(n)?n:x.isString(n)&&0<n.length?n.split(","):null;case"number":return x.isNumber(n)?n:parseFloat(n);case"string":return x.isString(n)?n:null;default:return n}}function c(n,e){return e&&x.isObject(n)?n[e]:n}var S,d=i.ngLocationSearchDefault?g.$eval(i.ngLocationSearchDefault):null,r=e[0],a=e[1],t=function(t){var s={},l=g.$eval(i.ngLocationSearchReplace),n=g.$eval(i.ngLocationSearchReset),u=i.ngLocationSearchUrl,f=D.location.href.replace(D.location.hash,""),e=i.ngLocationSearchDelay||0;try{var a=x.fromJson(t);t=a}catch(n){}x.forEach(S,function(n,e){var a=c(d,n);t||(a=null);var r=a;x.isObject(t)&&x.isDefined(t[n])?r=t[n]:x.isString(t)&&(r=t),x.isArray(r)&&(r=r.toString()),s[n]=r&&""!==r?r.toString():""===r?null:a});var h=y.search();n||(s=x.extend({},h,s)),x.equals(s,h)||(b.$broadcast("ngLocationSearchChangeStart",s,h),L(function(){if(x.isString(u)&&u!==f){var n=0!==u.indexOf("/"),e=-1!==u.indexOf("#!/")||-1!==u.indexOf("#/"),a=0===u.indexOf(y.protocol()),r=y.path(),t=$(D.location.hash.replace(y.url(),"")),i=w(s),o="";if(!y.$$html5||a)o=u+(i=i?"?"+i:""),!e&&a&&(r=r&&!y.$$html5?"/":"",o=u+t+r+i),D.location.href=o,y.search(s);else{if(y.search(i),l&&g.$apply(),n){var c=r.split("/");o=c[c.length-1]===u?r:r+"/"+u}else o=u;y.path(o),g.$apply()}}else y.search(s);b.$broadcast("ngLocationSearchChangeSuccess",s,h)},parseInt(e,10)))};if(i.ngLocationSearch&&(r||a)){var s;S=g.$eval(i.ngLocationSearch),S=x.isArray(S)?S:[i.ngLocationSearch];var l,u,f,h,v=d,m=function(r){var t=i.ngLocationSearchTypes?g.$eval(i.ngLocationSearchTypes):{};v=1<S.length?{}:d,x.forEach(S,function(n,e){var a=c(d,n);x.isObject(v)?v[n]=o(x.isDefined(r[n])?r[n]:a,t[n]):v=o(x.isDefined(r[n])?r[n]:a,t[n])}),x.isObject(v)&&(v=x.toJson(v)),(0,O(i.ngModel).assign)(g,v)};if(r){var p=function(n,e){if(n.$valid)t(e);else{var a=i.name;b.$broadcast("ngLocationSearchChangeError","model",a,n)}};g.$watch(function(){return r.$modelValue},function(n,e){if(n!==e){var a=i.ngLocationSearchDebounce;s&&L.cancel(s),a?s=L(function(){p(r,n)},parseInt(a,10)):p(r,n)}}),g.$on("$locationChangeStart",function(n,e,a,r,t){m(y.search())}),m(y.search())}if(a)u=function(r){if(0<S.length){var n=g.$eval(i.ngSubmit),t=i.ngLocationSearchTypes?g.$eval(i.ngLocationSearchTypes):{};v={$resetForm:void 0,$submitForm:f},x.forEach(S,function(n,e){var a=c(d,n);v[n]=o(x.isDefined(r[n])?r[n]:a,t[n]),x.isDefined(r[n])&&(v.$resetForm=l)}),n=x.isObject(n)?n:{},v=x.extend(n,v),(0,O(i.ngSubmit).assign)(g,v)}},h=function(n){var e=g.$eval(i.ngSubmit),a=i.name,r=g.$eval(a);return x.isUndefined(n)&&(n=e),!x.isDefined(n)||r&&!r.$valid?b.$broadcast("ngLocationSearchChangeError","form",a,r):t(n),e},f=function(n){n=x.isNumber(n)?n:i.ngLocationSearchDebounce,s&&L.cancel(s),n?s=L(function(){h()},parseInt(n,10)):h()},l=function(){h(null)},n.on("submit",function(){h()}),g.$on("$locationChangeStart",function(n,e,a,r,t){u(y.search())}),u(y.search())}g.$on("$destroy",function(){x.isDefined(g[i.ngSubmit])&&delete g[i.ngSubmit]})}}}])}(window.angular);